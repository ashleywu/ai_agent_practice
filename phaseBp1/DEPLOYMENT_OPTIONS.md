# 部署方案对比分析

## 问题背景
当前遇到网络代理问题，导致 Python requests 库无法连接到 AI Builder Platform API。

## 解决方案对比

### 方案 1: 临时禁用代理（环境变量）

**命令：**
```powershell
$env:HTTP_PROXY = ""
$env:HTTPS_PROXY = ""
python deploy.py --repo-url https://github.com/ashleywu/AI_agent_practice.git --service-name pw-aha-catcher
```

#### Pros ✅
- **简单快速**：只需两行命令
- **临时性**：不影响系统其他应用的代理设置
- **立即生效**：当前会话立即生效
- **无需修改代码**：保持代码干净
- **可逆**：关闭终端后自动恢复

#### Cons ❌
- **仅限当前会话**：每次新开终端都需要重新设置
- **可能影响其他应用**：如果当前会话有其他需要代理的程序会受影响
- **需要记住命令**：每次部署都要输入额外命令
- **不持久**：不能保存配置

**适用场景：**
- 一次性部署
- 测试部署流程
- 不想修改代码

---

### 方案 2: 使用 curl 直接调用 API

**命令：**
```powershell
curl.exe -X POST https://space.ai-builders.com/backend/v1/deployments `
  -H "Authorization: Bearer YOUR_API_KEY" `
  -H "Content-Type: application/json" `
  -d '{"repo_url": "...", "service_name": "pw-aha-catcher", ...}'
```

#### Pros ✅
- **绕过 Python 代理问题**：curl 可能使用不同的代理配置
- **直接控制**：完全控制请求参数
- **系统工具**：Windows 10+ 自带，无需安装
- **可脚本化**：可以保存为 .bat 或 .ps1 脚本
- **调试友好**：可以直接看到原始响应

#### Cons ❌
- **命令复杂**：JSON 需要转义，容易出错
- **无状态轮询**：需要手动检查部署状态（或写额外脚本）
- **无构建日志**：不会自动显示 streaming_logs
- **错误处理简单**：需要手动解析 JSON 错误
- **维护成本**：如果 API 变更需要手动更新命令

**适用场景：**
- Python 环境有问题时
- 需要快速测试 API 连接
- 一次性部署，不需要状态跟踪

---

### 方案 3: 修改 deploy.py 禁用代理

**实现方式：**
在 `deploy.py` 中添加代码禁用代理：
```python
import os
os.environ['HTTP_PROXY'] = ''
os.environ['HTTPS_PROXY'] = ''
os.environ['http_proxy'] = ''
os.environ['https_proxy'] = ''
```

#### Pros ✅
- **永久解决**：一次修改，以后都有效
- **自动化**：部署脚本自动处理，无需额外命令
- **团队友好**：其他人使用脚本时也会自动禁用代理
- **代码级控制**：可以在代码中智能判断是否需要代理
- **可配置化**：可以添加命令行参数控制是否使用代理

#### Cons ❌
- **修改代码**：需要改动 deploy.py
- **可能影响其他功能**：如果脚本有其他需要代理的功能会受影响
- **不够灵活**：如果某些环境需要代理就无法工作
- **需要测试**：修改后需要验证不影响其他功能

**适用场景：**
- 长期使用部署脚本
- 团队协作
- 希望自动化部署流程

---

### 方案 4: 配置 requests 库绕过代理（推荐）

**实现方式：**
在 `deploy.py` 中使用 requests 时禁用代理：
```python
response = requests.post(url, ..., proxies={'http': None, 'https': None})
```

#### Pros ✅
- **精确控制**：只影响这个请求，不影响其他代码
- **代码级解决**：一次修改永久有效
- **不影响系统**：不修改环境变量
- **灵活**：可以添加条件判断（如检测到代理问题时自动禁用）
- **最佳实践**：在代码中明确处理代理问题

#### Cons ❌
- **需要修改代码**：需要更新 deploy.py
- **需要测试**：确保不影响其他功能

**适用场景：**
- **推荐方案**：最平衡的解决方案
- 生产环境使用
- 需要可靠性和灵活性

---

## 推荐方案对比表

| 方案 | 复杂度 | 持久性 | 灵活性 | 推荐度 |
|------|--------|--------|--------|--------|
| 1. 临时禁用代理 | ⭐ 低 | ❌ 临时 | ⭐⭐⭐ 高 | ⭐⭐ 适合测试 |
| 2. 使用 curl | ⭐⭐ 中 | ✅ 可脚本化 | ⭐⭐ 中 | ⭐⭐ 备选方案 |
| 3. 修改环境变量 | ⭐ 低 | ✅ 永久 | ⭐⭐ 中 | ⭐⭐⭐ 简单有效 |
| 4. 配置 requests | ⭐⭐ 中 | ✅ 永久 | ⭐⭐⭐ 高 | ⭐⭐⭐⭐ **最推荐** |

---

## 最终推荐

### 🏆 最佳方案：方案 4（配置 requests 库）

**理由：**
1. ✅ 代码级控制，不影响系统配置
2. ✅ 一次修改，永久有效
3. ✅ 可以添加智能检测（自动判断是否需要禁用代理）
4. ✅ 不影响其他功能
5. ✅ 符合最佳实践

**实现：**
在 `deploy.py` 的请求函数中添加 `proxies` 参数。

### 🥈 备选方案：方案 1（临时禁用）

**理由：**
- 如果只是偶尔部署，不想修改代码
- 快速测试部署流程

---

## 建议实施步骤

1. **立即解决**：使用方案 1 快速部署一次
2. **长期方案**：实施方案 4，修改 `deploy.py` 添加代理处理
3. **备选**：如果方案 4 有问题，使用方案 2（curl）
